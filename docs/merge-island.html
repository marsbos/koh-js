<!doctype html>
<html lang="nl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="./styles.css" />

        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
        />
        <title>Koh.js - Merge Island</title>
    </head>
    <body class="bg-gray-100 p-8">
        <header class="bg-white p-4 shadow-md flex justify-between items-center mb-10">
            <h2 class="text-xl text-gray-500">ğŸï¸ Koh.js - Merge Island</h2>
        </header>

        <h1 class="text-lg">This example demonstrates the use of:</h1>
        <ul class="flex flex-col gap-3 mb-5">
            <li class="mt-3">
                <b class="feature">fromMerge:</b>
                Combine multiple independent streams into a single derived stream that updates
                automatically.
            </li>
            <li>
                <b class="feature">sync:</b>
                Bind streams to DOM elements so they update reactively.
            </li>
            <li>
                <b class="feature">on:</b>
                Attach event listeners that update streams or trigger side effects.
            </li>
        </ul>
        <section class="flex flex-col lg:flex-row gap-10 lg:gap-20">
            <div class="flex-2/4 order-1 lg:order-0">
                <div>
                    <pre><code class="language-javascript">
import { island } from './static/koh-js/core/index.js'
import {
    fromValue,
    fromInterval,
    fromMerge,
} from './static/koh-js/stream/index.js'

island('merge-island', k => {
    const a$ = fromValue(0)
    const b$ = fromValue(0)
    const timer$ = fromInterval(1000)
    const paused$ = fromValue(false)

    timer$.subscribe({
        pause() {
            paused$.next(true)
        },
        resume() {
            paused$.next(false)
        },
    })

    // Combine streams into one
    const sum$ = fromMerge(a$, b$, timer$).pipe(
        // Compute sum automatically
        vals => vals.reduce((prev, curr) => prev + curr, 0)
    )
    // Sync each value to its UI element
    k.sync('#a', a$)
    k.sync('#b', b$)
    k.sync('#timer', timer$)
    k.sync('#timer-p', paused$, (el, value) => {
        el.style.color = value ? 'lightgray' : 'teal'
    })

    k.sync('#sum', sum$, (el, val) => {
        el.textContent = val
        el.style.color = val % 2 === 0 ? 'teal' : 'coral'
    })

    // Buttons
    k.on('[name="inc-a"]', 'click', () => a$.next(c => c + 1))
    k.on('[name="inc-b"]', 'click', () => b$.next(c => c + 1))
    // Pause /resume
    k.on('[name="pause-timer"]', 'click', () => timer$.pause())
    k.on('[name="resume-timer"]', 'click', () => timer$.resume())
})
 </code>
                </pre>
                </div>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
            </div>

            <div class="flex-2/4">
                <merge-island name="merge-island">
                    <div class="flex flex-col gap-3">
                        <h3>&lt;merge-island&nbsp;/&gt;</h3>
                        <p id="timer-p">
                            Stream interval:
                            <span id="timer">0</span>
                        </p>
                        <p>
                            Stream A:
                            <span id="a">0</span>
                        </p>
                        <p>
                            Stream B:
                            <span id="b">0</span>
                        </p>
                        <p class="badge">
                            Merged=> Sum (A + B + interval):
                            <span id="sum">0</span>
                        </p>
                        <div class="py-3 flex lg:flex-row flex-col gap-3">
                            <button name="inc-a">Increment A</button>
                            <button name="inc-b">Increment B</button>
                            <button name="pause-timer">Pause interval</button>
                            <button name="resume-timer">Resume interval</button>
                        </div>
                    </div>

                    <script type="module">
                        import { island } from './static/koh-js/core/index.js'
                        import {
                            fromValue,
                            fromInterval,
                            fromMerge,
                        } from './static/koh-js/stream/index.js'

                        island('merge-island', k => {
                            const a$ = fromValue(0)
                            const b$ = fromValue(0)
                            const timer$ = fromInterval(1000)
                            const paused$ = fromValue(false)

                            timer$.subscribe({
                                pause() {
                                    paused$.next(true)
                                },
                                resume() {
                                    paused$.next(false)
                                },
                            })

                            // Combine streams into one
                            const sum$ = fromMerge(a$, b$, timer$).pipe(
                                // Compute sum automatically
                                vals => vals.reduce((prev, curr) => prev + curr, 0)
                            )
                            // Sync each value to its UI element
                            k.sync('#a', a$)
                            k.sync('#b', b$)
                            k.sync('#timer', timer$)
                            k.sync('#timer-p', paused$, (el, value) => {
                                el.style.color = value ? 'lightgray' : 'teal'
                            })

                            k.sync('#sum', sum$, (el, val) => {
                                el.textContent = val
                                el.style.color = val % 2 === 0 ? 'teal' : 'coral'
                            })

                            // Buttons
                            k.on('[name="inc-a"]', 'click', () => a$.next(c => c + 1))
                            k.on('[name="inc-b"]', 'click', () => b$.next(c => c + 1))
                            // Pause /resume
                            k.on('[name="pause-timer"]', 'click', () => timer$.pause())
                            k.on('[name="resume-timer"]', 'click', () => timer$.resume())
                        })
                    </script>
                </merge-island>
            </div>
        </section>
    </body>
</html>
