var p=Symbol("stream.skip"),c=class n{constructor(e,t,s=!0){this.observer=e,this.internalValue=t,this.subscribers=new Set,this.initialNotify=s,this.queue=new Set,this.hasPendingUpdates=!1,this.paused=!1}_processQueue(){this.hasPendingUpdates=!1,!this.paused&&(this.queue.forEach(e=>e.next?.(this.get())),this.queue.clear())}get(){return this.internalValue}cleanup(){this.destroyFn?.(),this.subscribers.clear(),this.observerCalled=!1,this.paused=!1,this.pendingUpdate=void 0}subscribe(e,t=!1){let{next:s,error:i,complete:u,pause:r,resume:o}=e;s||typeof e=="function"&&(s=e),i||(i=()=>{}),u||(u=()=>{}),r||(r=()=>{}),o||(o=()=>{});let a={next:s,error:i,complete:u,pause:r,resume:o};return this.subscribers.add(a),!this.observerCalled&&this.observer&&(this.observerCalled=!0,this.destroyFn=this.observer({next:this.next.bind(this),error:this.error.bind(this),complete:this.complete.bind(this),pause:this.pause.bind(this),resume:this.resume.bind(this)})),(this.initialNotify||t)&&a.next?.(this.internalValue),()=>{this.subscribers.delete(a),this.subscribers.size<1&&this.destroyFn?.()}}_batch(){this.subscribers.forEach(e=>{this.queue.add(e),this.hasPendingUpdates||(this.hasPendingUpdates=!0,queueMicrotask(this._processQueue.bind(this)))})}error(e){this.subscribers.forEach(t=>{t.error(e)})}pause(){this.paused=!0,this.subscribers.forEach(e=>e.pause())}resume(){this.paused&&(this.paused=!1,this.subscribers.forEach(e=>e.resume()))}complete(){this.subscribers.forEach(e=>{e.complete()}),this.cleanup()}next(e){if(this.paused)return;let t=e,s=this.get();typeof e=="function"&&(t=e(s)),!(!(e instanceof Node)&&Object.is(t,this.internalValue))&&(this.internalValue=t,this._batch())}pipe(...e){return new n(t=>{let s=this.subscribe({async next(i){let u=i;try{for(let r of e)if(u=await r(u,()=>p),u===p)return;t.next(u)}catch(r){console.error("Stream operator error:",r),t.error(r)}},error(i){console.error("Stream operator error from source stream!:",i),t.error(i)},complete(){t.complete()},pause(){t.pause()},resume(){t.resume()}});return()=>{s()}},this.get(),!1)}};var m=(n,e,{raf:t=!1,immediate:s=!1,...i}={})=>new c(u=>{let r=null,o=a=>{if(t){if(r)return;r=requestAnimationFrame(()=>{u.next(a),r=null})}else u.next(a)};return n.addEventListener(e,o,i),()=>{r&&(cancelAnimationFrame(r),r=null),n.removeEventListener(e,o,i)}},null,s);var b=n=>{let e=null;return new c(t=>(e=setInterval(()=>t.next(s=>s+1),n),()=>{e&&(clearInterval(e),e=null)}),0,!1)};var d=n=>{let e=null,t=()=>{e&&(clearTimeout(e),e=null)};return new c(s=>(e=setTimeout(()=>{s.next(!0),s.complete()},n),t),!1,!1)};var x=n=>new c(null,n,!0);var g=n=>{let e=[];if(n&&typeof n=="object")for(let[t,s]of Object.entries(n))e.push(`${encodeURIComponent(t)}=${encodeURIComponent(s)}`);return e.length?e.join("&"):""},y=(n,e={},t={})=>{let s,i=new c(null,{params:t,baseUrl:n,url:n,options:e},!0),u=i.pipe(async({params:r,url:o,options:a},h)=>{s?.abort(),s=new AbortController;try{let f=g(r);return await(await fetch(f?`${o}?${f}`:o,{...a,signal:s.signal})).json()}catch(f){return f.name==="AbortError"||i.error(f),h()}});return{pipe:u.pipe.bind(u),subscribe(r){return u.subscribe(r)},next(r){let o="",a=i.get()?.options??{},h=i.get()?.params??{},f=l=>{typeof l=="object"?(o=l.url??n,a=l?.options??a,h=l?.params?{...h,...l.params}:h):typeof l=="string"&&(o=l)};if(typeof r=="function"){let l=i.get();f(r(l))}else f(r);i.next({params:h,baseUrl:n,url:o,options:a})}}};var w=(...n)=>{let e=new c(null,null,!0),t=[],s=r=>o=>{t[r]=o,e.next([...t])},i=n.reduce((r,o,a)=>[...r,o.subscribe(s(a))],[]),u=e.subscribe.bind(e);return e.subscribe=r=>{let o=u(r);return()=>{o(),i.forEach(a=>{a()})}},e};export{m as fromEvent,y as fromFetch,b as fromInterval,w as fromMerge,d as fromTimer,x as fromValue};
