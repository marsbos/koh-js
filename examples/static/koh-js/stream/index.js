var h=Symbol("stream.skip"),u=class n{constructor(e,r,s=!0){this.observer=e,this.internalValue=r,this.subscribers=new Set,this.initialNotify=s,this.queue=new Set,this.hasPendingUpdates=!1}_processQueue(){this.hasPendingUpdates=!1,this.queue.forEach(e=>e.next?.(this.get())),this.queue.clear()}get(){return this.internalValue}cleanup(){this.destroyFn?.(),this.subscribers.clear(),this.observerCalled=!1}subscribe(e,r=!1){let{next:s,error:o,complete:i}=e;s||typeof e=="function"&&(s=e),o||(o=()=>{}),i||(i=()=>{});let t={next:s,error:o,complete:i};return this.subscribers.add(t),!this.observerCalled&&this.observer&&(this.observerCalled=!0,this.destroyFn=this.observer({next:this.next.bind(this),error:this.error.bind(this),complete:this.complete.bind(this)})),(this.initialNotify||r)&&t.next?.(this.internalValue),()=>{this.subscribers.delete(t),this.subscribers.size<1&&this.destroyFn?.()}}_batch(){this.subscribers.forEach(e=>{this.queue.add(e),this.hasPendingUpdates||(this.hasPendingUpdates=!0,queueMicrotask(this._processQueue.bind(this)))})}error(e){this.subscribers.forEach(r=>{r.error(e)})}complete(){this.subscribers.forEach(e=>{e.complete()}),this.cleanup()}next(e){let r=e,s=this.get();typeof e=="function"&&(r=e(s)),!(!(e instanceof Node)&&Object.is(r,this.internalValue))&&(this.internalValue=r,this._batch())}pipe(...e){return new n(r=>{let s=this.subscribe({async next(o){let i=o;try{for(let t of e)if(i=await t(i,()=>h),i===h)return;r.next(i)}catch(t){console.error("Stream operator error:",t),r.error(t)}},error(o){console.error("Stream operator error from source stream!:",o),r.error(o)},complete(){r.complete()}});return()=>{s()}},this.get(),!1)}};var p=(n,e,{raf:r=!1,immediate:s=!1,...o}={})=>new u(i=>{let t=null,c=l=>{if(r){if(t)return;t=requestAnimationFrame(()=>{i.next(l),t=null})}else i.next(l)};return n.addEventListener(e,c,o),()=>{t&&(cancelAnimationFrame(t),t=null),n.removeEventListener(e,c,o)}},null,s);var b=n=>{let e=null;return new u(r=>(e=setInterval(()=>r.next(s=>s+1),n),()=>{e&&(clearInterval(e),e=null)}),0,!1)};var d=n=>{let e=null,r=()=>{e&&(clearTimeout(e),e=null)};return new u(s=>(e=setTimeout(()=>{s.next(!0),s.complete()},n),r),!1,!1)};var x=n=>new u(null,n,!0);var g=n=>{let e=[];if(n&&typeof n=="object")for(let[r,s]of Object.entries(n))e.push(`${encodeURIComponent(r)}=${encodeURIComponent(s)}`);return e.length?e.join("&"):""},y=(n,e={},r={})=>{let s,o=new u(null,{params:r,baseUrl:n,url:n,options:e},!0),i=o.pipe(async({params:t,url:c,options:l},m)=>{s?.abort(),s=new AbortController;try{let f=g(t);return await(await fetch(f?`${c}?${f}`:c,{...l,signal:s.signal})).json()}catch(f){return f.name==="AbortError"||o.error(f),m()}});return{pipe:i.pipe.bind(i),subscribe(t){return i.subscribe(t)},next(t){let c="",l=o.get()?.options??{},m=o.get()?.params??{},f=a=>{typeof a=="object"?(c=a.url??n,l=a?.options??l,m=a?.params?{...m,...a.params}:m):typeof a=="string"&&(c=a)};if(typeof t=="function"){let a=o.get();f(t(a))}else f(t);o.next({params:m,baseUrl:n,url:c,options:l})}}};var w=(...n)=>{let e=new u(null,null,!1),r=[],s=t=>c=>{r[t]=c,e.next([...r])},o=n.reduce((t,c,l)=>[...t,c.subscribe(s(l))],[]),i=e.subscribe.bind(e);return e.subscribe=t=>{let c=i(t);return()=>{c(),o.forEach(l=>{l()})}},e};export{p as fromEvent,y as fromFetch,b as fromInterval,w as fromMerge,d as fromTimer,x as fromValue};
