var p=t=>(e,s)=>{let o=t._findEl(e,"hide");t.subscribe(s,i=>{o.hidden=!!i})};var b=t=>(e,{stream:s,key:o,tpl:i,render:d})=>{let a=t._findEl(e,"foreach"),c=new Map;t.subscribe(s,l=>{if(!Array.isArray(l))return;let x=new Set(l.map(r=>o(r)));for(let[r,h]of c)x.has(r)||(h.remove(),c.delete(r));let f=a.firstChild;l.forEach(r=>{let h=o(r),n=c.get(h);if(!n){if(d)n=d(r);else if(i){let u=a.querySelector(i).cloneNode(!0);u.removeAttribute("data-template"),u.removeAttribute("hidden"),u.setData(r),n=u}n||t._throwError("foreach","could not create node"),c.set(h,n)}(!n.isConnected||n!==f)&&a.insertBefore(n,f),f=n.nextSibling})})};var _=t=>(e,s,o)=>{let i=t._findEl(e,"on");i.addEventListener(s,o),t._onDispose(()=>i.removeEventListener(s,o))};var E=t=>(e,s)=>{let o=t._findEl(e,"show");t.subscribe(s,i=>{o.hidden=!i})};var w=t=>(e,s,o="textContent")=>{let i=t._findEl(e,"sync");t.subscribe(s,d=>{if(typeof o=="function"){let a=o(i,d);a&&typeof a=="object"&&Object.entries(a).forEach(([c,l])=>i[c]=l)}else i[o]=d},!0)};var y=t=>({foreach:b(t),hide:p(t),on:_(t),show:E(t),sync:w(t)});var m=class extends HTMLElement{constructor(e){super(),this.islandModule=e,this._mounted=!1,this._disposers=[],this._delegated={}}_dispose(){for(let e of this._disposers)e?.();this._disposers=[]}_onDispose(e){this._disposers.push(e)}_throwError(e,s){throw new Error(`[k.${e}] on <${this.tagName.toLowerCase()}>: ${s}`)}_findEl(e,s){let o=this.qs(e);return o||this._throwError(s,`${e} not found!`),o}qs(e,s=this){return typeof e=="string"?s.querySelector(e):e}qsa(e,s=this){return[...s.querySelectorAll(e)]}subscribe(e,s,o=!1){if(!("subscribe"in e))throw new Error("argument is not a Stream instance!");let i=e.subscribe(s,o);return this._onDispose(i),i}island(e){}setData(e){return this.initialData=e,this}connectedCallback(){this._mounted||(this._mounted=!0,this.islandModule({initialData:this.initialData,qs:this.qs.bind(this),qsa:this.qsa.bind(this),subscribe:this.subscribe.bind(this),island:this.island.bind(this),...y(this)}))}disconnectedCallback(){queueMicrotask(()=>{this.isConnected||(this._mounted=!1,this._dispose())})}},k=(t,e)=>{if(customElements.get(t))return;let s=o=>class extends m{constructor(){super(o)}connectedCallback(){this.hasAttribute("data-template")||super.connectedCallback()}};customElements.define(t,s(e))};export{k as island};
